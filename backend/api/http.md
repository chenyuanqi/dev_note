
### HTTP 协议概述
HTTP 是一个客户端终端（用户）和服务器端（网站）请求和应答的标准（TCP）。通过使用 Web 浏览器、网络爬虫或者其它的工具，客户端发起一个 HTTP 请求到服务器上指定端口（默认端口为 80）。我们称这个客户端为用户代理程序（user agent）。应答的服务器上存储着一些资源，比如 HTML 文件和图像。我们称这个应答服务器为源服务器（origin server）。在用户代理和源服务器中间可能存在多个“中间层”，比如代理服务器、网关或者隧道（tunnel）。  

尽管 TCP/IP 协议是互联网上最流行的应用，但是在 HTTP 协议中，并没有规定必须使用它或它支持的层。事实上，HTTP 可以在任何互联网协议上，或其他网络上实现。HTTP 假定其下层协议提供可靠的传输。因此，任何能够提供这种保证的协议都可以被其使用。因此也就是其在 TCP/IP 协议族使用 TCP 作为其传输层。  

通常，由 HTTP 客户端发起一个请求，创建一个到服务器指定端口（默认是 80 端口）的 TCP 连接。HTTP 服务器则在那个端口监听客户端的请求。一旦收到请求，服务器会向客户端返回一个状态，比如"HTTP/1.1 200 OK"，以及返回的内容，如请求的文件、错误消息、或者其它信息。

### HTTP 三层架构
```
                Request
浏览器（browser）——————> Internet ——————> Web Server
                <------          <------
                                 Response
```
### HTTP 两个核心
1、请求（Request）req  
2、响应（Response）res  

> 请求 URL（uniform resource locator）统一资源定位器，它可以用来标识一个资源，指明了如何定位这个资源（DNS、IP）  
> 请求信息包括请求行、空行、其他消息体  
> 
> 当浏览器接收并显示网页前，此网页所在的服务器会返回一个包含 HTTP 状态码的信息头（server header）用以响应浏览器的请求
> HTTP 状态码[参考](http://www.restapitutorial.com/httpstatuscodes.html)  
>
> HTTP 动词包括 HEAD、GET、POST、PUT、PATCH、DELETE  
>
> GET 和 POST 有各自的语意，通常 GET 用于获取资源，而 POST 用于修改资源  
> GET 和 POST 最直观的区别在于 GET 把参数包含在 URL 中，POST 通过 request body 传递参数（相对安全）；
> 实际上，GET 和 POST 本质上就是 TCP 链接，GET 产生一个 TCP 数据，而 POST 产生两个 TCP 数据包（Firefox 只发一次）  

### HTTP 一个记住
> HTTP 协议是无状态协议  
> 会话控制：服务器的实现 session 与客户端的支持 cookie  

### HTTPS 
在 HTTP 协议上增加了 SSL(secure socket layer)层（即 SSL 层 - 应用层 - 传输层 - 网络层 - 链路层 - 实体层）
```
# HTTPS 认证流程
                             发起请求
                      --------------------------->　　server 
                              下发证书
                      <---------------------------    server 
                      证书数字签名(用证书机构公钥加密)
                      --------------------------->　　证书机构 
                          证书数字签名验证通过
client(内置证书机构证书) <---------------------------  证书机构
                      公钥加密随机密码串(未来的共享秘钥)
                     --------------------------->　　 server私钥解密(非对称加密)
                        SSL协议结束　HTTP协议开始
                      <---------------------------    server(对称加密)
                            共享秘钥加密 HTTP
                     --------------------------->　 　server(对称加密)
```
> 核对证书： 证书机构的公开秘钥验证证书的数字签名  
> 使用非对称加密，公钥加密建立连接  
> 共享密钥加密  

### Websocket
Websocket 是一种持久化协议，基于 TCP，跟 HTTP 协议同级，属于全双工通信，由客户端建立连接（简而言之，客户端发送 GET 请求，告诉服务端要进行协议升级，服务器给客户端转换协议，进而建立 WebSocket 连接）。  
为了建立一个 WebSocket 连接，客户端浏览器首先要向服务器发起一个 HTTP 请求，这个请求和通常的 HTTP 请求不同，包含了一些附加头信息，其中附加头信息”Upgrade: WebSocket”表明这是一个申请协议升级的 HTTP 请求，服务器端解析这些附加的头信息然后产生应答信息返回给客户端，客户端和服务器端的 WebSocket 连接就建立起来了，双方就可以通过这个连接通道自由的传递信息，并且这个连接会持续存在直到客户端或者服务器端的某一方主动的关闭连接。  

> 长链接是指让客户端浏览器与服务器端保持长久的连接，并能持续通讯，它可以反向 ajax（服务器推技术）  
> 长链接技术有轮循（模拟型的实时），长轮循，SSE 等  

### HTTP2
由于 HTTP 1.1 包含了太多细节和可选内容，也为未来的扩展预留了很多选项，使得它过于庞大，而且它也很难完全使用出 TCP 协议所能提供的所有强大能力；另外，加载网站所需的资源，带来的恼人延迟 ... HTTP2 应运而生。  
> 克服延迟之道有很多，比如雪碧图（Spriting）、小图内联（Inlining）、JS 文件拼接（Concatenation）和分片（Sharding）  

改善 HTTP 协议显然是极好的事情  
> 降低协议对延迟的敏感  
> 修复 pipelining 和 head of line blocking 的问题  
> 防止主机需求更高的连接数量  
> 保留所有现有的接口，内容，URI 格式和结构  
> 由 IETF 的 HTTPbis 工作组来制定协议  

HTTP2 都带来哪些细节和概念呢？  
- 全双工通信  
> 服务端和客户端终端通信双方设备既是发送器，也是接收器  

- 二进制传输  
> HTTP2 是一个二进制协议，使成帧的使用变得更为便捷  
> HTTP2 会发送不同类型的二进制帧（公共字段：Type, Length, Flags, Stream Identifier 和 frame payload）  

- 多路复用  
> 多个请求共享一个 TCP 连接  

- 优先级和依赖性  
> 借助于 PRIORITY 帧，客户端同样可以告知服务器当前的流依赖于其他哪个流  
> 优先级和依赖关系可以在传输过程中被动态的改变  

- 头部压缩  
> 保证了 HTTP 的可重复性，提升请求速度  

- 重置 - 后悔药  
> HTTP2 可以通过发送 RST_STREAM 帧来实现重置当前传输的消息，从而避免浪费带宽和中断已有的连接  

- 服务器推送  
> 也叫“缓存推送”，客户端请求资源前，服务端主动将资源推送给客户端以备将来之需  
> 客户端可以通过发送一个 RST_STREAM 帧来中止服务器推送  

- 流量控制  
> 数据帧会受到流量控制，流的两端都必须告诉对方自己还有足够的空间来处理新的数据  
