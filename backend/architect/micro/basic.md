
### 微服务
微服务是当下最火热的后端架构之一。  

微服务的概念最早是在 2014 年由 Martin Fowler 和 James Lewis 共同提出，他们定义了微服务是由单一应用程序构成的小服务，拥有自己的进程与轻量化处理，服务依业务功能设计，以全自动的方式部署，与其他服务使用 HTTP API 通讯。同时，服务会使用最小规模的集中管理 （例如 Docker）技术，服务可以用不同的编程语言与数据库等。  

单体应用架构的缺陷：部署效率低下、团队协作开发成本高、系统高可用性差、线上发布变慢。  

服务化就是把传统的单机应用中通过 JAR 包依赖产生的本地方法调用，改造成通过 RPC 接口产生的远程方法调用。
微服务相比服务化：服务拆分粒度更细、服务独立部署、服务独立维护、服务治理能力要求高。  
微服务架构是将复杂臃肿的单体应用进行细粒度的服务化拆分，每个拆分出来的服务各自独立打包部署，并交由小团队进行开发和运维，从而极大地提高了应用交付的效率，并被各大互联网公司所普遍采用。  

**服务化拆分时机**  
项目第一阶段的主要目标是快速开发和验证想法，证明产品思路是否可行；随着项目发展，需要大规模地扩张开发人员，以支撑多个功能的开发，一旦单体应用同时进行开发的人员超过 10 人就该进行服务化拆分。  

从单体应用迁移到微服务架构时必将面临的问题：  
1、服务如何定义  
对于单体应用来说，不同功能模块之前相互交互时，通常是以类库的方式来提供各个模块的功能；对于微服务来说，每个服务都运行在各自的进程之中，应该以接口的方式向外界传达自己的信息，无论采用哪种通讯协议，是 HTTP 还是 RPC，服务之间的调用都通过接口描述来约定，约定内容包括接口名、接口参数以及接口返回值。  
2、服务如何发布和订阅  
单体应用由于部署在同一个 WAR 包里，接口之间的调用属于进程内的调用；拆分为微服务独立部署后，服务提供者该如何对外暴露自己的地址，服务调用者通过注册中心（类似登记处的地方，能够记录每个服务提供者的地址以供服务调用者查询）查询所需要调用的服务的地址。  
3、服务如何监控  
QPS（调用量）、AvgTime（平均耗时）以及 P999（99.9% 的请求性能在多少毫秒以内）等这些指标需要一种通用的监控方案，能够覆盖业务埋点、数据收集、数据处理，最后到数据展示的全链路功能。  
4、服务如何治理  
拆分为微服务架构后，服务的数量变多了，依赖关系也变复杂了。比如一个服务的性能有问题时，依赖的服务都势必会受到影响。可以设定一个调用性能阈值，如果一段时间内一直超过这个值，那么依赖服务的调用可以直接返回，这就是熔断，也是服务治理最常用的手段之一。  
5、故障如何定位  
在单体应用拆分为微服务之后，一次用户调用可能依赖多个服务，每个服务又部署在不同的节点上，如果用户调用出现问题，你需要有一种解决方案能够将一次用户请求进行标记，并在多个依赖的服务系统中继续传递，以便串联所有路径，从而进行故障定位。  

**服务化拆分姿势**  
1、纵向拆分：从业务维度进行拆分，将不同的功能模块服务化，独立部署和运维；标准是按照业务的关联程度来决定，关联比较密切的业务适合拆分为一个微服务，而功能相对比较独立的业务适合单独拆分为一个微服务。比如社交 App 可以认为首页信息流是一个服务，评论是一个服务，消息通知是一个服务，个人主页也是一个服务。  
2、横向拆分：从公共且独立功能维度拆分；标准是按照是否有公共的被多个其他服务调用，且依赖的资源独立不与其他业务耦合。比如社交 App 无论是首页信息流、评论、消息箱还是个人主页，都需要显示用户的昵称。把用户的昵称功能单独部署成一个独立的服务，那么有什么变更我只需要上线这个服务即可，其他服务不受影响，开发和上线成本就大大降低了。  

### 微服务架构
微服务架构包含服务描述、注册中心、服务框架、服务监控、服务追踪、服务治理。  

服务提供者（即提供服务的一方）按照一定格式的服务描述，向注册中心注册服务，声明自己能够提供哪些服务以及服务的地址是什么，完成服务发布。  
服务消费者（即调用服务的一方）请求注册中心，查询所需要调用服务的地址，然后以约定的通信协议向服务提供者发起请求，得到请求结果后再按照约定的协议解析结果。  
在服务的调用过程中，服务的请求耗时、调用量以及成功率等指标都会被记录下来用作监控，调用经过的链路信息会被记录下来，用于故障定位和问题追踪。在这期间，如果调用失败，可以通过重试等服务治理手段来保证成功率。  

**服务描述**  
