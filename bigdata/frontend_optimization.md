
### Gzip 压缩
开启 Gzip，具体的做法非常简单，只需要你在你的 request headers 中加上这么一句：accept-encoding:gzip

HTTP 压缩是一种内置到网页服务器和网页客户端中以改进传输速度和带宽利用率的方式。在使用 HTTP 压缩的情况下，HTTP 数据在从服务器发送前就已压缩：兼容的浏览器将在下载所需的格式前宣告支持何种方法给服务器；不支持压缩方法的浏览器将下载未经压缩的数据。最常见的压缩方案包括 Gzip 和 Deflate...

HTTP 压缩就是以缩小体积为目的，对 HTTP 内容进行重新编码的过程。  
Gzip 的内核就是 Deflate，目前我们压缩文件用得最多的就是 Gzip。可以说，Gzip 就是 HTTP 压缩的经典例题。  
Gzip 是高效的，压缩后通常能帮我们减少响应 70% 左右的大小。但它并非万能，Gzip 并不保证针对每一个文件的压缩都会使其变小。  
Gzip 压缩背后的原理，是在一个文本文件中找出一些重复出现的字符串、临时替换它们，从而使整个文件变小。根据这个原理，文件中代码的重复率越高，那么压缩的效率就越高，使用 Gzip 的收益也就越大。反之亦然。  

一般来说，Gzip 压缩是服务器的活儿：服务器了解到我们这边有一个 Gzip 压缩的需求，它会启动自己的 CPU 去为我们完成这个任务。而压缩文件这个过程本身是需要耗费时间的，大家可以理解为我们以服务器压缩的时间开销和 CPU 开销（以及浏览器解析压缩文件的开销）为代价，省下了一些传输过程中的时间开销。  
既然存在着这样的交换，那么就要求我们学会权衡。服务器的 CPU 性能不是无限的，如果存在大量的压缩需求，服务器也扛不住的。服务器一旦因此慢下来了，用户还是要等。Webpack 中 Gzip 压缩操作的存在，事实上就是为了在构建过程中去做一部分服务器的工作，为服务器分压。  
因此，这两个地方的 Gzip 压缩，谁也不能替代谁。它们必须和平共处，好好合作。  

### CDN 缓存与回源机制
CDN （Content Delivery Network，即内容分发网络）指的是一组分布在各个地区的服务器。这些服务器存储着数据的副本，因此服务器可以根据哪些服务器与用户距离最近，来满足数据的请求。 CDN 提供快速服务，较少受高流量影响。

假设我的根服务器在杭州，此时有一位北京的用户向我请求资源。在网络带宽小、用户访问量大的情况下，杭州的这一台服务器或许不那么给力，不能给用户非常快的响应速度。于是我灵机一动，把这批资源 copy 了一批放在北京的机房里。当用户请求资源时，就近请求北京的服务器，北京这台服务器低头一看，这个资源我存了，离得这么近，响应速度肯定噌噌的！那如果北京这台服务器没有 copy 这批资源呢？它会再向杭州的根服务器去要这个资源。在这个过程中，北京这台服务器就扮演着 CDN 的角色...

CDN 的核心点有两个，一个是缓存，一个是回源。  
这两个概念都非常好理解。对标到上面描述的过程，“缓存” 就是说我们把资源 copy 一份到 CDN 服务器上这个过程，“回源” 就是说 CDN 发现自己没有这个资源（一般是缓存的数据过期了），转头向根服务器（或者它的上层服务器）去要这个资源的过程...  

CDN 往往被用来存放静态资源。  
业务服务器仿佛一个车间，车间里运转的机器轰鸣着为我们产出所需的资源；相比之下，CDN 服务器则像一个仓库，它只充当资源的 “栖息地” 和“搬运工”。  
所谓 “静态资源”，就是像 JS、CSS、图片等不需要业务服务器进行计算即得的资源。而 “动态资源”，顾名思义是需要后端实时动态生成的资源，较为常见的就是 PHP、JSP、ASP 或者依赖服务端渲染得到的 HTML 页面。  
什么是 “非纯静态资源” 呢？它是指需要服务器在页面之外作额外计算的 HTML 页面。具体来说，当我打开某一网站之前，该网站需要通过权限认证等一系列手段确认我的身份、进而决定是否要把 HTML 页面呈现给我。这种情况下 HTML 确实是静态的，但它和业务服务器的操作耦合，我们把它丢到 CDN 上显然是不合适的...  
静态资源本身具有访问频率高、承接流量大的特点，因此静态资源加载速度始终是前端性能的一个非常关键的指标。CDN 是静态资源提速的重要手段，在许多一线的互联网公司，“静态资源走 CDN” 并不是一个建议，而是一个规定。  
如何让 CDN 的效用最大化？这就涉及到了 CDN 服务器本身的性能优化、CDN 节点的地址选取等。  
- CDN 服务器性能优化
> 一层是实际上是硬件优化，你的服务器选型就是一种优化。你是用 ssd，还是用 saker 硬盘，你是该用 pce 卡，还是应该用 ssd。你的 CPU 应该用至强还是应该用阿童木的等等，都是需要去斟酌。  
> 至于二层，链路层的优化指的就是资源方面。比如机房如何去选择。    
> 三层路由层是指你在 middlemell 这块真正选路的具体的细节，后面会有一个图来具体讲一下。  
> 四层是指传输层的优化，我们一般的业务全都是 TCP，所以说这里面就可以明确的说这里是指 TCP 的优化。还有一个就是七层也是可以优化的。比如说你强行对内容进行压缩，甚至你改变压缩级别去压缩。  

- CDN 节点的地址选取
> 比如我们注意到淘宝首页的地址是 www.taobao.com，但是 CDN 服务器的域名是 g.alicdn.com。  
> Cookie 是紧跟域名的。同一个域名下的所有请求，都会携带 Cookie。大家试想，如果我们此刻仅仅是请求一张图片或者一个 CSS 文件，我们也要携带一个 Cookie 跑来跑去（关键是 Cookie 里存储的信息我现在并不需要），这是一件多么劳民伤财的事情。Cookie 虽然小，请求却可以有很多，随着请求的叠加，这样的不必要的 Cookie 带来的开销将是无法想象的...  
> 同一个域名下的请求会不分青红皂白地携带 Cookie，而静态资源往往并不需要 Cookie 携带什么认证信息。把静态资源和主页面置于不同的域名下，完美地避免了不必要的 Cookie 的出现！  
> 看起来是一个不起眼的小细节，但带来的效用却是惊人的。以电商网站静态资源的流量之庞大，如果没把这个多余的 Cookie 拿下来，不仅用户体验会大打折扣，每年因性能浪费带来的经济开销也将是一个非常恐怖的数字。


